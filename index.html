<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chi≈Ñczyk</title>
    <style>
    #canvas {
        border-style: solid;
    }
    </style>
    <script>
      var game = {}

      game.board = {}

      game.board.filds = [
        [3,3, , ,0,0,4, , ,4,4,],
        [3,3, , ,0,4,0, , ,4,4,],
        [ , , , ,0,4,0, , , , ,],
        [ , , , ,0,4,0, , , , ,],
        [3,0,0,0,0,4,0,0,0,0,0,],
        [0,3,3,3,3,0,1,1,1,1,0,],
        [0,0,0,0,0,2,0,0,0,0,1,],
        [ , , , ,0,2,0, , , , ,],
        [ , , , ,0,2,0, , , , ,],
        [2,2, , ,0,2,0, , ,1,1,],
        [2,2, , ,2,0,0, , ,1,1,]
      ]

      game.board.players = [
        [0,0, , ,0,0,0, , ,0,0,],
        [0,0, , ,0,0,0, , ,0,0,],
        [ , , , ,0,0,0, , , , ,],
        [ , , , ,0,0,0, , , , ,],
        [0,0,0,0,0,0,0,0,0,0,0,],
        [0,0,0,0,0, ,0,0,0,0,0,],
        [0,0,0,0,0,0,0,0,0,0,0,],
        [ , , , ,0,0,0, , , , ,],
        [ , , , ,0,0,0, , , , ,],
        [0,0, , ,0,0,0, , ,0,0,],
        [0,0, , ,0,0,0, , ,0,0,]
      ]

      game.board.clear = () => {
        for (var i = 0; i < 11; i++)
          for (var j = 0; j < 11; j++)
            if (game.board.players[i][j] !== undefined) game.board.players[i][j] = 0
      }

      game.init = (canvasId, width, height) => {
        game.canvasElement = document.getElementById(canvasId)
        game.canvasElement.addEventListener('click', game.onClick, false)
        game.context = game.canvasElement.getContext('2d')
        game.canvas = game.context.canvas
        game.canvas.width = width
        game.canvas.height = height
        game.point = canvas.width/11
        game.radius = game.point/2 - game.point/10
        game.drawBoard()
      }

      game.onClick = (event) => {
        var x = event.pageX - game.canvasElement.offsetLeft
        var y = event.pageY - game.canvasElement.offsetTop
        var i = Math.floor(x/game.point)
        var j = Math.floor(y/game.point)
        // if(++game.board.players[j][i] > 4) game.board.players[j][i] = 0
        game.move(j, i)
        game.drawBoard()
      }

      game.drawField = (i, j, shade) => {
        if(game.board.filds[j][i] != undefined) {
          var x = game.point/2 + game.point*i
          var y = game.point/2 + game.point*j
          game.context.beginPath()
          game.context.arc(x, y, game.radius, 0, 2 * Math.PI, false)
          game.context.fillStyle = game.board.players[j][i] == 0
                                 ? game.getColor(game.board.filds[j][i])
                                 : game.getColor(game.board.players[j][i], 1)
          game.context.fill()
        }
      }

      game.getColor = (id, shade) => {
        switch (id) {
          case 0: //Grey
            switch (shade) {
              default: return '#EEEEEE' //200
            }
          case 1: //Green
            switch (shade) {
              case 1: return '#388E3C' //700
              default: return '#C8E6C9' //100
            }
          case 2: //Yellow
            switch (shade) {
              case 1: return '#FBC02D' //700
              default: return '#FFF9C4' //100
            }
          case 3: //Red
            switch (shade) {
              case 1: return '#D32F2F' //700
              default: return '#FFCDD2' //100
            }
          case 4: //Blue
            switch (shade) {
              case 1: return '#1565C0' //700
              default: return '#BBDEFB' //100
            }
          default:
            switch (shade) {
              default: return 'white'
            }
        }
      }

      game.drawBoard = () => {
        game.context.fillStyle = game.getColor()
        game.context.fillRect(0, 0, game.canvas.width, game.canvas.height)
        for (var i = 0; i < 11; i++)
          for (var j = 0; j < 11; j++)
            game.drawField(i, j)
      }

      game.filds = []

      game.filds[1] = {
        home: [[9,5],[8,5],[7,5],[6,5]],
        board: [[10,6],[9,6],[8,6],[7,6],[6,6],[6,7],[6,8],[6,9],[6,10],[5,10]],
        start: [[9,9],[10,9],[9,10],[10,10]],
        order: [1,2,3,4]
      }

      game.filds[2] = {
        home: [[5,9],[5,8],[5,7],[5,6]],
        board: [[4,10],[4,9],[4,8],[4,7],[4,6],[3,6],[2,6],[1,6],[0,6],[0,5]],
        start: [[0,9],[1,9],[0,10],[1,10]],
        order: [2,3,4,1]
      }

      game.filds[3] = {
        home: [[1,5],[2,5],[3,5],[4,5]],
        board: [[0,4],[1,4],[2,4],[3,4],[4,4],[4,3],[4,2],[4,1],[4,0],[5,0]],
        start: [[0,0],[1,0],[0,1],[1,1]],
        order: [3,4,1,2]
      }

      game.filds[4] = {
        home: [[5,1],[5,2],[5,3],[5,4]],
        board: [[6,0],[6,1],[6,2],[6,3],[6,4],[7,4],[8,4],[9,4],[10,4],[10,5]],
        start: [[9,0],[10,0],[9,1],[10,1]],
        order: [4,1,2,3]
      }

      game.player = 1
      game.players = [,
        [[9,9],[10,9],[9,10],[10,10]],
        [[0,9],[1,9],[0,10],[1,10]],
        [[0,0],[1,0],[0,1],[1,1]],
        [[9,0],[10,0],[9,1],[10,1]]
      ]

      game.setPlayers = () => {
        game.board.clear()
        for (var i = 1; i < 5; i++)
          for (var cell of game.players[i])
            game.board.players[cell[0]][cell[1]] = i
        game.board.players[5][5] = game.player
        game.drawBoard()
      }

      game.getRandom = (min, max) => {
        return Math.floor(Math.random() * (max - min + 1)) + min
      }

      game.dice = {}

      game.dice.last = 5

      game.dice.throw = () => {
        game.dice.last = game.getRandom(1, 6)
        return game.dice.last
      }

      game.getFilds = (playerID) => {
        var result = []
        result = result.concat(game.filds[playerID].start)
        for (var i of game.filds[playerID].order)
          result = result.concat(game.filds[i].board)
        return result.concat(game.filds[playerID].home)
      }

      game.getState = (playerID) => {
        var result = []
        for (var xy of game.getFilds(playerID))
          result.push(game.board.players[xy[1]][xy[0]])
        return result
      }

      game.start = () => {
        game.players = [,
          [[9,9],[10,9],[9,10],[10,10]],
          [[9,0],[10,0],[9,1],[10,1]],
          [[0,0],[1,0],[0,1],[1,1]],
          [[0,9],[1,9],[0,10],[1,10]],
        ]
        game.player = 1
        game.setPlayers()
      }

      game.getId = (playerID, x, y)  => {
        for (var i=0; i<4; ++i)
          if(game.players[game.player][i][0] == x && game.players[game.player][i][1] == y)
            return i
      }

      game.getFildId = (playerID, x, y)  => {
        var count = 0
        for (var xy of game.getFilds(playerID)) {
          count++
          if(xy[1] == x && xy[0] ==y) return count
         }
      }

      game.move = (x, y) => {
        console.log("A")
        if(game.board.players[x][y] == game.player) {
          console.log("B", game.getFildId(game.player, x, y))
          var id = game.getId(game.player, x, y)
          var fildId = game.getFildId(game.player, x, y)
          if(fildId + game.dice.last < 48) {
            console.log("C")
            game.players[game.player][id] = game.getFilds(game.player)[fildId + game.dice.last]
            if(++game.player > 4) game.player = 1
            game.setPlayers()
          }
        }
      }

      var player = {}

    </script>
  </head>
  <body>
    <canvas id="canvas">
        Use a Modern Web Browser
    </canvas>
    <script>
      game.init('canvas', 800, 800)
      game.start()
    </script>
  </body>
</html>
